<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<head>
    <title>홈</title>
</head>

<body>
<div layout:fragment="content">
    <section class="container mx-auto px-4">
        <div class="container mt-20">
            <div class="logo text-center mb-10">
                <h1 class="text-5xl font-bold text-gradient-mindlog mb-4">Mindlog</h1>
                <p class="text-mindlog-text-secondary text-lg">당신의 감정일기</p>
            </div>

            <div id="logged-in" class="hidden bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl p-8 text-center max-w-md mx-auto shadow-2xl">
                <div class="text-green-400 mb-6 text-xl font-medium">✓ 로그인되었습니다</div>
                <div class="mb-8">
                    <p class="text-white text-lg mb-2">오늘의 감정을 기록해보세요.</p>
                    <a th:href="@{/diaries}" class="text-mindlog-purple-400 hover:text-white underline transition-colors font-medium">내 일기장으로 이동 &rarr;</a>
                </div>
                <a th:href="@{/auth/logout}" data-turbo="false" class="inline-block bg-white/10 text-white px-6 py-2 rounded-lg hover:bg-white/20 transition-all border border-white/10">로그아웃</a>
            </div>

            <div id="logged-out" class="hidden bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl p-8 text-center max-w-md mx-auto shadow-2xl">
                <p class="text-mindlog-text-secondary mb-8 text-lg">소셜 계정으로 간편하게 시작하세요</p>
                <a th:href="@{/auth/login}" data-turbo="false" class="inline-block bg-gradient-to-r from-purple-600 to-blue-600 text-white px-10 py-3 rounded-xl font-semibold hover:scale-105 transition-all shadow-lg hover:shadow-purple-500/30">
                    로그인 / 회원가입
                </a>
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="scripts">
    <script>
        // 간단한 로그인 상태 체크 (실제 서비스에서는 서버 렌더링이 더 좋지만, 현재 구조상 호환)
        document.addEventListener("DOMContentLoaded", function() {
            // 세션 쿠키 이름 등 실제 환경에 맞게 조정 필요
            // 여기서는 간단히 UI 요소가 있는지 여부나, 서버에서 내려준 값을 활용할 수도 있음
            // 예시: Navbar의 로그인/로그아웃 버튼 상태로 추론하거나, 서버에서 th:if로 렌더링하는 것을 추천.

            // 임시: 모든 케이스를 커버하기 위해 JS로 처리 (서버 사이드 렌더링(SSR) 권장)
            // 현재 구조에서는 Thymeleaf sec:authorize를 Navbar에서 쓰고 있으므로
            // 여기 Home 본문도 서버에서 th:if="${#authentication.name != 'anonymousUser'}" 로 처리하는게 가장 깔끔합니다.

            // 일단 JS 방식 유지 (기존 코드 존중)
            const isLoggedIn = document.cookie.includes('JSESSIONID'); // 또는 토큰 쿠키
            // *더 정확한 방법*: 서버에서 로그인 여부를 class로 내려주는 것.

            // (서버 렌더링이 안 된 경우를 대비한 JS 백업 로직)
            const loggedInEl = document.getElementById('logged-in');
            const loggedOutEl = document.getElementById('logged-out');

            // Navbar에 '로그아웃' 버튼이 보이면 로그인 상태로 간주
            const navbarLogoutBtn = document.querySelector('a[href*="/auth/logout"]');

            if (navbarLogoutBtn) {
                loggedInEl.classList.remove('hidden');
            } else {
                loggedOutEl.classList.remove('hidden');
            }
        });
    </script>
</th:block>
</body>
</html>