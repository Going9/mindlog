<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/base}">

<head>
    <title th:text="${diary.shortContent}">일기 보기</title>
</head>

<body>
    <div layout:fragment="content" class="max-w-3xl mx-auto px-4 py-10 sm:px-6 lg:px-8">
        <div
            class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 sm:p-10 dark:bg-gray-800 dark:border-gray-700">
            <header class="mb-10 text-center">
                <a th:href="@{/diaries}"
                    class="inline-flex items-center gap-x-1.5 text-sm text-gray-500 decoration-2 hover:underline font-medium mb-8">
                    <svg class="w-2.5 h-2.5" wixmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z" />
                    </svg>
                    목록으로 돌아가기
                </a>

                <time class="block text-sm text-stone-500 font-medium mb-3 uppercase tracking-wide"
                    th:text="${#temporals.format(diary.date, 'yyyy. MM. dd')}">2026. 01. 16</time>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight dark:text-gray-200"
                    th:text="${diary.shortContent}">
                    오늘의 일기 제목
                </h1>
            </header>

            <div class="space-y-12">
                <section th:if="${diary.imageUrl != null}" class="rounded-xl overflow-hidden">
                    <img th:src="${diary.imageUrl}" alt="일기 이미지" class="w-full h-auto object-cover max-h-[500px]">
                </section>

                <section th:if="${diary.situation != null}">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">상황</h3>
                    <p class="text-lg text-gray-800 leading-relaxed whitespace-pre-wrap dark:text-gray-200"
                        th:text="${diary.situation}"></p>
                </section>

                <div
                    class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 border-t border-gray-100 pt-8 dark:border-gray-700">
                    <section th:if="${diary.reaction != null}">
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">생각 (반응)</h3>
                        <p class="text-base text-gray-800 leading-relaxed whitespace-pre-wrap dark:text-gray-200"
                            th:text="${diary.reaction}"></p>
                    </section>
                    <section th:if="${diary.physicalSensation != null}">
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">신체 감각</h3>
                        <p class="text-base text-gray-800 leading-relaxed whitespace-pre-wrap dark:text-gray-200"
                            th:text="${diary.physicalSensation}"></p>
                    </section>
                </div>

                <section th:if="${diary.desiredReaction != null}"
                    class="bg-emerald-50/50 p-6 rounded-2xl border border-emerald-100/50 dark:bg-emerald-900/10 dark:border-emerald-900/20">
                    <h3 class="text-xs font-bold text-emerald-600 uppercase tracking-wider mb-3 dark:text-emerald-400">
                        적응적 생각</h3>
                    <p class="text-lg text-emerald-900 leading-relaxed whitespace-pre-wrap dark:text-emerald-300"
                        th:text="${diary.desiredReaction}"></p>
                </section>

                <div th:if="${diary.gratitudeMoment != null || diary.selfKindWords != null}"
                    class="grid grid-cols-1 gap-8 border-t border-gray-100 pt-8 dark:border-gray-700">
                    <div class="flex flex-col gap-8">
                        <section th:if="${diary.gratitudeMoment != null}">
                            <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">감사한 순간</h3>
                            <p class="text-base text-gray-800 leading-relaxed whitespace-pre-wrap dark:text-gray-200"
                                th:text="${diary.gratitudeMoment}"></p>
                        </section>
                        <section th:if="${diary.selfKindWords != null}">
                            <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">나에게 쓰는 편지</h3>
                            <p class="text-base text-gray-800 leading-relaxed whitespace-pre-wrap italic dark:text-gray-200"
                                th:text="${diary.selfKindWords}"></p>
                        </section>
                    </div>
                </div>

                <footer class="pt-10 flex justify-center gap-x-3 border-t border-gray-200 mt-10 dark:border-gray-700">
                    <a th:href="@{/diaries/{id}/edit(id=${diary.id})}"
                        class="py-2.5 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-white dark:hover:bg-gray-800">
                        <svg class="flex-shrink-0 w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                        </svg>
                        수정하기
                    </a>
                    <button type="button" id="delete-diary-btn" th:data-diary-id="${diary.id}"
                        class="py-2.5 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-red-100 text-red-800 hover:bg-red-200 disabled:opacity-50 disabled:pointer-events-none dark:hover:bg-red-900 dark:text-red-500 dark:hover:text-red-400">
                        <svg class="flex-shrink-0 w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18" />
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                            <line x1="10" x2="10" y1="11" y2="17" />
                            <line x1="14" x2="14" y1="11" y2="17" />
                        </svg>
                        삭제하기
                    </button>
                </footer>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script th:inline="javascript">
            (function () {
                const initDeleteBtn = () => {
                    const deleteBtn = document.getElementById('delete-diary-btn');
                    if (deleteBtn && !deleteBtn.dataset.listenerAdded) {
                        deleteBtn.addEventListener('click', async function () {
                            if (confirm('정말로 이 일기를 삭제하시겠습니까?')) {
                                const id = this.getAttribute('data-diary-id');
                                try {
                                    const response = await fetch(`/diaries/${id}`, {
                                        method: 'DELETE'
                                    });
                                    if (response.ok) {
                                        window.location.href = '/diaries';
                                    } else {
                                        alert('삭제에 실패했습니다.');
                                    }
                                } catch (err) {
                                    console.error('Delete error:', err);
                                    alert('오류가 발생했습니다.');
                                }
                            }
                        });
                        deleteBtn.dataset.listenerAdded = 'true';
                    }
                };

                document.addEventListener('turbo:load', initDeleteBtn);
                initDeleteBtn();
            })();
        </script>
    </th:block>
</body>

</html>