<!DOCTYPE html>
<html layout:decorate="~{${viewLayout}}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:th="http://www.thymeleaf.org">

<th:block layout:fragment="title" th:text="${diaryId == null ? '새 일기 쓰기' : '일기 수정하기'}"></th:block>

<div class="page-shell" layout:fragment="content">

    <div data-controller="tag">

        <div class="text-center space-y-2 mb-6">
            <h1 class="page-title" th:text="${diaryId == null ? '오늘의 기록' : '기록 수정'}"></h1>
            <p class="page-subtitle" th:text="${diaryId == null ? '오늘 하루, 당신의 마음은 어땠나요?' : '마음을 다시 들여다보며 수정합니다.'}"></p>
        </div>

        <form class="surface-panel-strong space-y-6 p-5 sm:p-7 pb-20" id="diary-form" method="post"
            th:action="@{${diaryId == null ? '/diaries' : '/diaries/' + diaryId}}" th:object="${diaryRequest}">

            <input name="_method" th:value="${diaryId == null} ? '' : 'put'" type="hidden">

            <div class="space-y-6">
                <!-- 기록 날짜 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="date">기록 날짜</label>
                    <input
                        class="form-input"
                        id="date" name="date"
                        th:classappend="${#fields.hasErrors('date')} ? '!border-red-500 focus:!border-red-500 focus:!ring-red-500' : ''"
                        th:value="${#temporals.format(diaryRequest.date, 'yyyy-MM-dd')}" type="date">
                    <p class="mt-2 text-sm text-red-600" th:errors="*{date}" th:if="${#fields.hasErrors('date')}">날짜 에러
                    </p>
                </div>

                <!-- 한줄 요약 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="shortContent">한줄 요약</label>
                    <input
                        class="form-input"
                        id="shortContent" placeholder="오늘 하루를 한 문장으로 표현한다면?"
                        th:classappend="${#fields.hasErrors('shortContent')} ? '!border-red-500 focus:!border-red-500 focus:!ring-red-500' : ''"
                        th:field="*{shortContent}" type="text">
                    <p class="mt-2 text-sm text-red-600" th:errors="*{shortContent}"
                        th:if="${#fields.hasErrors('shortContent')}">내용 에러</p>
                </div>

                <!-- 감정 태그 -->
                <div>
                    <th:block th:replace="~{fragments/tag-management :: tag-management}"></th:block>
                </div>

                <!-- 상황 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="situation">상황</label>
                    <textarea
                        class="form-input min-h-24"
                        id="situation" placeholder="어떤 상황이었나요?" rows="3" th:field="*{situation}"></textarea>
                </div>

                <!-- 나의 반응 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="reaction">나의 반응</label>
                    <textarea
                        class="form-input min-h-24"
                        id="reaction" placeholder="그때 어떻게 행동했나요?" rows="3" th:field="*{reaction}"></textarea>
                </div>

                <!-- 신체 감각 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="physicalSensation">신체 감각</label>
                    <textarea
                        class="form-input min-h-24"
                        id="physicalSensation" placeholder="몸에서는 어떤 느낌이 들었나요?" rows="3"
                        th:field="*{physicalSensation}"></textarea>
                </div>

                <!-- 원했던 반응 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="desiredReaction">원했던 반응</label>
                    <textarea
                        class="form-input min-h-24"
                        id="desiredReaction" placeholder="어떻게 행동하고 싶었나요?" rows="3"
                        th:field="*{desiredReaction}"></textarea>
                </div>

                <!-- 감사한 순간 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="gratitudeMoment">감사한 순간</label>
                    <textarea
                        class="form-input min-h-24"
                        id="gratitudeMoment" placeholder="오늘 감사한 일은 무엇인가요?" rows="3"
                        th:field="*{gratitudeMoment}"></textarea>
                </div>

                <!-- 나에게 해주고 싶은 말 -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-stone-700" for="selfKindWords">나에게 해주고 싶은
                        말</label>
                    <textarea
                        class="form-input min-h-24"
                        id="selfKindWords" placeholder="자기 자신을 다독여주세요." rows="3" th:field="*{selfKindWords}"></textarea>
                </div>

                <!-- 버튼 영역 -->
                <div class="mt-8 flex justify-end gap-x-2">
                    <a class="btn-secondary"
                        th:href="@{${diaryId == null ? '/diaries' : '/diaries/' + diaryId}}">
                        <th:block th:replace="~{fragments/spinner :: loading-spinner('text-stone-700')}"></th:block>
                        <span class="loading-hide">취소</span>
                        <span class="hidden turbo-loading-show">취소 중...</span>
                    </a>
                    <button id="submit-btn"
                        class="btn-primary disabled:opacity-50 disabled:pointer-events-none"
                        type="submit">
                        <th:block th:replace="~{fragments/spinner :: loading-spinner-white}"></th:block>
                        <span class="loading-hide">저장하기</span>
                        <span class="hidden turbo-loading-show">저장 중...</span>
                    </button>
                </div>
            </div>
        </form>

    </div>
</div>

</html>
