<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{${viewLayout}}">

<head>
    <title>로그인</title>
</head>

<body>
    <div layout:fragment="content" class="flex items-center justify-center min-h-[calc(100vh-5rem)] p-4">
        <div class="w-full max-w-md card p-8 sm:p-10">
            <div class="text-center mb-10">
                <h1 class="block text-2xl font-bold text-stone-800">Mindlog 시작하기</h1>
                <p class="mt-2 text-sm text-stone-500">
                    소셜 계정으로 간편하게 로그인하세요.
                </p>
            </div>

            <div>
                <div th:if="${param.error}"
                    class="mb-6 bg-red-50 border border-red-100 text-sm text-red-600 rounded-xl p-4" role="alert">
                    <div class="flex items-center gap-3">
                        <svg class="flex-shrink-0 h-4 w-4 text-red-500" xmlns="http://www.w3.org/2000/svg" width="24"
                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <path d="m15 9-6 6" />
                            <path d="m9 9 6 6" />
                        </svg>
                        <div>
                            <span th:if="${#strings.equals(param.error, 'auth_failed')}">인증에 실패했습니다. 다시 시도해주세요.</span>
                            <span th:if="${#strings.equals(param.error, 'token_exchange_failed')}">로그인 처리 중 오류가
                                발생했습니다.</span>
                            <span th:if="${#strings.equals(param.error, 'invalid_session')}">세션이 만료되었습니다.</span>
                            <span
                                th:unless="${#strings.equals(param.error, 'auth_failed') or #strings.equals(param.error, 'token_exchange_failed') or #strings.equals(param.error, 'invalid_session')}">
                                로그인 중 문제가 발생했습니다.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <a th:href="@{/auth/login/google}"
                       data-turbo="false"
                       target="_top"
                       id="googleBtn"
                       class="w-full py-3.5 px-4 inline-flex justify-center items-center gap-x-3 text-sm font-medium rounded-xl border border-stone-200 bg-white text-stone-700 shadow-sm hover:bg-stone-50 transition-all">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" class="w-5 h-5" alt="Google">
                        Google로 계속하기
                    </a>

                    <a th:href="@{/auth/login/kakao}"
                       data-turbo="false"
                       target="_top"
                       id="kakaoBtn"
                       class="w-full py-3.5 px-4 inline-flex justify-center items-center gap-x-3 text-sm font-medium rounded-xl border border-transparent bg-[#FEE500] text-[#000000] hover:bg-[#FDD835] transition-all shadow-sm">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3C6.48 3 2 6.48 2 10.76c0 2.79 1.86 5.27 4.74 6.69-.21.78-.77 2.82-.88 3.23-.14.53.19.52.4.38.27-.18 4.24-2.8 5.88-3.9 5.86.08 10.61-3.39 10.61-7.66C22 6.48 17.52 3 12 3z" />
                        </svg>
                        카카오로 계속하기
                    </a>
                </div>
            </div>
        </div>
        <script>
            (function () {
                const ua = navigator.userAgent || '';
                // 안드로이드 앱 웹뷰인지 확인하는 정밀한 로직
                const isNativeApp = ua.includes('wv') || ua.includes('Mindlog-Android');

                if (isNativeApp) {
                    // 앱일 때만 링크 뒤에 source=app을 붙여줌
                    const googleBtn = document.getElementById('googleBtn');
                    const kakaoBtn = document.getElementById('kakaoBtn');

                    if(googleBtn) googleBtn.href += (googleBtn.href.includes('?') ? '&' : '?') + 'source=app';
                    if(kakaoBtn) kakaoBtn.href += (kakaoBtn.href.includes('?') ? '&' : '?') + 'source=app';

                    console.log('[Mindlog] 앱 환경 감지: source=app 파라미터 추가 완료');
                }
            })();
        </script>
    </div>
</body>

</html>