# Mindlog 웹 표준 운영 체크리스트 (Spring Boot + Thymeleaf + Turbo + Stimulus)

## 1. 목적
- 브랜치: `release/web-starter-v1`
- 목표: 기능 추가보다 **표준 흐름 유지**를 우선한다.
- 범위: `로그인 + 홈 + 일기 CRUD`.
- 상세 기준선: `/Users/iggyu/mindlog-workspace/mindlog/docs/표준_근접화_기준선.md`와 항상 정합을 유지한다.

## 1-1. 브랜치 운영 규칙
- 구현은 작업 브랜치에서만 수행한다. 브랜치 prefix 표준: `feat/*`, `fix/*`, `refactor/*`, `docs/*`, `test/*`, `chore/*`, `perf/*`, `build/*`, `ci/*`, `hotfix/*`.
- 작업 브랜치는 `release/web-starter-v1`로 먼저 머지한다.
- 릴리즈 검증 후 `release/web-starter-v1`를 `main`으로 머지한다.
- `release/web-starter-v1`, `main`에서 직접 기능 수정 커밋을 금지한다.
- 커밋 메시지는 Conventional Commits prefix(`feat:`, `fix:`, `refactor:`, `docs:`, `test:`, `chore:`, `perf:`, `build:`, `ci:`, `revert:`) + 한국어 제목을 사용한다.

## 2. 표준 기준(잠금값)
- 서버: Spring MVC + Thymeleaf 렌더링 중심.
- 웹 네비게이션: Turbo Drive 기본 동작 유지.
- 프론트 상호작용: Stimulus 컨트롤러 단위로 최소화.
- 인증 앱 분기: `source=app` + 세션 플래그 기반.
- 보안: CSRF 기본 활성화.

## 3. 공식 레퍼런스
- Turbo Drive: https://turbo.hotwired.dev/handbook/drive
- Turbo Building(캐시/메타): https://turbo.hotwired.dev/handbook/building
- Turbo Drive API: https://turbo.hotwired.dev/reference/drive
- Stimulus Lifecycle: https://stimulus.hotwired.dev/reference/lifecycle-callbacks
- Spring MVC + Thymeleaf 가이드: https://spring.io/guides/gs/serving-web-content/
- Spring 폼 처리 가이드: https://spring.io/guides/gs/handling-form-submission/
- Spring 보안 가이드: https://spring.io/guides/gs/securing-web/
- Spring 하이퍼미디어/브라우저 강화 글: https://spring.io/blog/2024/03/15/hypermedia-and-browser-enhancement/

## 4. 현재 유지할 항목
- `303/422` 규약 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/java/com/mindlog/domain/diary/controller/DiaryController.java`
- `source=app` 세션 컨텍스트 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/java/com/mindlog/global/config/AppSourceContext.java`
- User-Agent 추론 제거 상태 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/java/com/mindlog/global/config/GlobalModelAdvice.java`
- CSRF 활성화 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/java/com/mindlog/global/config/SecurityConfig.java`
- 로그인 교환 완료 페이지(`no-cache`) 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/resources/templates/auth/exchange-complete.html`
- 알림 계약은 Flash attribute(`noticeCode`) 1회성 방식 유지: `/Users/iggyu/mindlog-workspace/mindlog/src/main/resources/static/js/controllers/flash_notice_controller.js`
- 네이티브 최소 로딩은 Android `VisitTransitionCoordinator` 단일 상태머신으로 적용: `/Users/iggyu/mindlog-workspace/mindlog-android/app/src/main/java/com/mindlog/android/navigation/VisitTransitionCoordinator.kt`
- Hotwire web 목적지는 커스텀 Fragment(`MindlogWebFragment`)를 기본으로 사용: `/Users/iggyu/mindlog-workspace/mindlog-android/app/src/main/java/com/mindlog/android/navigation/MindlogWebFragment.kt`
- 날짜/선택 입력은 커스텀 컴포넌트(Flatpickr/custom-select) 계약 유지.

## 5. 금지 규칙(재발 방지)
- User-Agent로 앱/웹 분기 금지.
- 컨트롤러 성공 응답에서 `200 + view` 남용 금지(POST/PUT/DELETE 성공은 303).
- 전역 CSRF 비활성화 금지.
- Turbo 문제를 `data-turbo="false"` 남발로 우회 금지.
- 페이지 이동 문제를 글로벌 `window.location` 강제 전환으로 덮는 방식 금지.

## 6. 권장 규칙(표준 근접)
- `turbo-init.js`는 부트스트랩 최소 책임만 유지한다.
- UI 알림/토스트/폼 로딩은 Stimulus 컨트롤러로 분리한다.
- 인증 핸드오버 화면(`app-callback`, `exchange-complete`)은 단일 책임으로 유지한다.
- 풀페이지 화면은 Turbo Drive 중심, Turbo Frame은 부분 갱신이 필요한 경우에만 사용한다.

## 7. PR 체크리스트(필수)
- [ ] 신규/수정 폼 성공 시 303, 검증 실패 시 422를 지키는가?
- [ ] 인증 흐름에서 `/auth/login -> /auth/callback -> /auth/exchange` 계약이 깨지지 않는가?
- [ ] `source=app` 세션 플래그가 유지되는가?
- [ ] CSRF 미포함 보호 요청이 403으로 차단되는가?
- [ ] Turbo/Stimulus 중복 초기화(이벤트 중복 바인딩)가 없는가?
- [ ] Android WebView 로그인 후 홈 인증 UI가 새로고침 없이 반영되는가?
- [ ] 삭제/생성/수정 알림이 URL 쿼리 기반이 아닌 Flash 1회성으로 동작하는가?
- [ ] 요청 5개 액션(이전 달/다음 달/최신순/오래된순/이동)과 리스트 -> 상세에서 최소 지연(`500ms`)이 일관 적용되는가?
- [ ] Android 오버레이 스피너가 visit 완료 후 정상 해제되고(stuck 없음), 중첩 표시되지 않는가?
- [ ] 커스텀 confirm/날짜/셀렉트 UI가 서버 파라미터 계약을 깨지 않는가?
- [ ] 연/월 셀렉트 드롭다운이 패널에 클리핑되지 않고 아래로 정상 확장되는가?
- [ ] 모바일에서 메뉴 펼침 후 다른 화면 이동/복귀 시 네브바가 닫힌 상태로 복귀하는가?
- [ ] 메뉴 -> 감정 인사이트 이동 시 메뉴가 먼저 닫혀 보이는 깜빡임이 재현되지 않는가?

## 8. 운영 메모(이번 이슈 기준)
- 간헐 깜빡임/흰 화면은 Redis 캐시보다, 네비게이션 레벨(중복 방문, 전환 타이밍, WebView 교체 구간) 영향이 큰 증상으로 본다.
- 따라서 성능 튜닝(쿼리/Redis) 전에 네비게이션 규약 준수 여부를 먼저 점검한다.
